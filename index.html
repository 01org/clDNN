<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>clDNN: clDNN Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">clDNN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">clDNN Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>Compute Library for Deep Neural Networks (clDNN) is a middle-ware software for accelerating DNN inference on Intel&reg; HD and Iris&trade; Pro Graphics. This project includes CNN primitives implementations on Intel GPUs with C and C++ interfaces.</p>
<p>clDNN Library implements set of primitives:</p><ul>
<li>Convolution</li>
<li>Fully connected (inner product)</li>
<li>Pooling<ul>
<li>average</li>
<li>maximum</li>
</ul>
</li>
<li>Normalization<ul>
<li>across channel</li>
<li>within channel</li>
<li>batch</li>
</ul>
</li>
<li>Activation<ul>
<li>logistic</li>
<li>tanh</li>
<li>rectified linear unit (ReLU)</li>
<li>softplus (softReLU)</li>
<li>abs</li>
<li>square</li>
<li>sqrt</li>
<li>linear</li>
</ul>
</li>
<li>Softmax</li>
<li>Crop</li>
<li>Deconvolution</li>
<li>Depth concatenation</li>
<li>Eltwise</li>
<li>ROI pooling</li>
<li>Simpler NMS</li>
<li>Prior box</li>
<li>Detection output</li>
</ul>
<p>With this primitive set, user can build and execute most common image recognition, semantic segmentation and object detection networks topologies like:</p><ul>
<li>Alexnet*</li>
<li>Googlenet*(v1,v2)</li>
<li>ResNet*</li>
<li>VGG*</li>
<li>faster-rCNN* and other.</li>
</ul>
<h1><a class="anchor" id="model"></a>
Programming Model</h1>
<p>Intel&reg; clDNN is graph oriented library. To execute CNN you have to build, compile graph/topology and run to get results.</p>
<p><b> Terminology: </b></p><ul>
<li>Primitive - dnn base functionality i.e. convolution, pooling, softmax.</li>
<li>Data - special primitive type representing primitive parameters (weights and biases), inputs and outputs</li>
<li>Engine - type of accelerator that is executing network. Currently ocl engine is the only aviable.</li>
<li>Topology - container of primitives, data, and relations between then. Topology represents graph.</li>
<li>Program - optional step between Topology and Network. It is compiled Topology without memory allocations</li>
<li>Network - compiled Topology with memory allocations. Can be executed. During compilation, buidling parameters triggers special optimizations like fusing, data reordering.</li>
</ul>
<p><b> Execution Steps: </b></p><ol type="1">
<li>Create Engine</li>
<li>Declare or define primitives parameters (weights and biases) if needed.</li>
<li>Create primitives. Each primitive requires to provide input name. This is a name of primitive which output will be input to current one. Name can be used before primitive definition.</li>
<li>Create topology</li>
<li>Add primitives to topology</li>
<li>Build Network from topology</li>
<li>Set Inputs data</li>
<li>Execute Network</li>
</ol>
<h1><a class="anchor" id="example"></a>
C++ API Example MNIST network</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;api/CPP/memory.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/topology.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/reorder.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/input_layout.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/convolution.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/data.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/pooling.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/fully_connected.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/softmax.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/engine.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;api/CPP/network.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecldnn.html">cldnn</a>;</div><div class="line"><span class="keyword">using namespace </span>std;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <a class="code" href="structcldnn_1_1tensor.html#a1e822dca3c7365bd41058907bf119fe2">tensor::value_type</a></div><div class="line">        input_channels = 1,</div><div class="line">        input_size = 28,</div><div class="line">        conv1_out_channels = 20,</div><div class="line">        conv2_out_channels = 50,</div><div class="line">        conv_krnl_size = 5,</div><div class="line">        fc1_num_outs = 500,</div><div class="line">        fc2_num_outs = 10;</div><div class="line"></div><div class="line"><span class="comment">// Create layout with same sizes but new format.</span></div><div class="line"><a class="code" href="structcldnn_1_1layout.html">layout</a> create_reordering_layout(<a class="code" href="structcldnn_1_1format.html">format</a> new_format, <span class="keyword">const</span> <a class="code" href="structcldnn_1_1layout.html">layout</a>&amp; src_layout)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> { src_layout.<a class="code" href="structcldnn_1_1layout.html#a5832c02b2c3487c23000796c0e97dcf0">data_type</a>, new_format, src_layout.<a class="code" href="structcldnn_1_1layout.html#ae84c460aee3a37c7e0f8c83d83e8cb1f">size</a> };</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Create MNIST topology</span></div><div class="line"><a class="code" href="structcldnn_1_1topology.html">topology</a> create_topology(<span class="keyword">const</span> <a class="code" href="structcldnn_1_1layout.html">layout</a>&amp; in_layout, <span class="keyword">const</span> <a class="code" href="structcldnn_1_1memory.html">memory</a>&amp; conv1_weights_mem, <span class="keyword">const</span> <a class="code" href="structcldnn_1_1memory.html">memory</a>&amp; conv1_bias_mem )</div><div class="line">{</div><div class="line">    <span class="keyword">auto</span> data_type = in_layout.<a class="code" href="structcldnn_1_1layout.html#a5832c02b2c3487c23000796c0e97dcf0">data_type</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Create input_layout description</span></div><div class="line">    <span class="comment">// &quot;input&quot; - is the primitive id inside topology</span></div><div class="line">    <a class="code" href="structcldnn_1_1input__layout.html">input_layout</a> input(<span class="stringliteral">&quot;input&quot;</span>, in_layout);</div><div class="line"></div><div class="line">    <span class="comment">// Create topology object with 2 primitives</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">cldnn:: topology</a> <a class="code" href="structcldnn_1_1topology.html">topology</a>(</div><div class="line">        <span class="comment">// 1. input layout primitive.</span></div><div class="line">        input,</div><div class="line">        <span class="comment">// 2. reorder primitive with id &quot;reorder_input&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1reorder.html">reorder</a>(<span class="stringliteral">&quot;reorder_input&quot;</span>,</div><div class="line">            <span class="comment">// input primitive for reorder (implicitly converted to primitive_id)</span></div><div class="line">            input,</div><div class="line">            <span class="comment">// output layout for reorder</span></div><div class="line">            create_reordering_layout(<a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6ae0d35fc1dcf8e6b5522b798f67bc3e2b">format::yxfb</a>, in_layout))</div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="comment">// Create data primitive - its content should be set already.</span></div><div class="line">    <a class="code" href="structcldnn_1_1data.html">cldnn::data</a> conv1_weights( <span class="stringliteral">&quot;conv1_weights&quot;</span>, conv1_weights_mem );</div><div class="line"></div><div class="line">    <span class="comment">// Add primitive to topology</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">topology</a>.<a class="code" href="structcldnn_1_1topology.html#a2574507502bd3acbfe1769aee23d8039">add</a>(conv1_weights);</div><div class="line"></div><div class="line">    <span class="comment">// Emplace new primitive to topology</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">topology</a>.<a class="code" href="structcldnn_1_1topology.html#a2574507502bd3acbfe1769aee23d8039">add</a>&lt;<a class="code" href="structcldnn_1_1data.html">cldnn::data</a>&gt;({ <span class="stringliteral">&quot;conv1_bias&quot;</span>, conv1_bias_mem });</div><div class="line"></div><div class="line">    <span class="comment">// Emplace 2 primitives</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">topology</a>.<a class="code" href="structcldnn_1_1topology.html#a2574507502bd3acbfe1769aee23d8039">add</a>(</div><div class="line">        <span class="comment">// Convolution primitive with id &quot;conv1&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1convolution.html">convolution</a>(<span class="stringliteral">&quot;conv1&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;reorder_input&quot;</span>,    <span class="comment">// primitive id of the convolution&#39;s input</span></div><div class="line">            { conv1_weights },  <span class="comment">// weights primitive id is taken from the object</span></div><div class="line">            { <span class="stringliteral">&quot;conv1_bias&quot;</span> }    <span class="comment">// bias primitive id</span></div><div class="line">        ),</div><div class="line">        <span class="comment">// Pooling id: &quot;pool1&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1pooling.html">pooling</a>(<span class="stringliteral">&quot;pool1&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;conv1&quot;</span>,                <span class="comment">// Input: &quot;conv1&quot;</span></div><div class="line">            <a class="code" href="group__cpp__primitives.html#gga44a38e1c6afb8bfb7f74d0c20cd0fba3a2ffe4e77325d9a7152f7086ea7aa5114">pooling_mode::max</a>,      <span class="comment">// Pooling mode: MAX</span></div><div class="line">            spatial(2,2),  <span class="comment">// stride: 2</span></div><div class="line">            spatial(2,2)   <span class="comment">// kernel_size: 2</span></div><div class="line">        )</div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="comment">// Conv2 weights data is not available now, so just declare its layout</span></div><div class="line">    <a class="code" href="structcldnn_1_1layout.html">layout</a> conv2_weights_layout(data_type, <a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6a6e811d769af6fd0cdd32bd8b1a695d4c">format::bfyx</a>,{ conv2_out_channels, conv1_out_channels, conv_krnl_size, conv_krnl_size });</div><div class="line"></div><div class="line">    <span class="comment">// Define the rest of topology.</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">topology</a>.<a class="code" href="structcldnn_1_1topology.html#a2574507502bd3acbfe1769aee23d8039">add</a>(</div><div class="line">        <span class="comment">// Input layout for conv2 weights. Data will passed by network::set_input_data()</span></div><div class="line">        <a class="code" href="structcldnn_1_1input__layout.html">input_layout</a>(<span class="stringliteral">&quot;conv2_weights&quot;</span>, conv2_weights_layout),</div><div class="line">        <span class="comment">// Input layout for conv2 bias.</span></div><div class="line">        <a class="code" href="structcldnn_1_1input__layout.html">input_layout</a>(<span class="stringliteral">&quot;conv2_bias&quot;</span>, { data_type, <a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6a6e811d769af6fd0cdd32bd8b1a695d4c">format::bfyx</a>, spatial(conv2_out_channels) }),</div><div class="line">        <span class="comment">// Second convolution id: &quot;conv2&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1convolution.html">convolution</a>(<span class="stringliteral">&quot;conv2&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;pool1&quot;</span>,                <span class="comment">// Input: &quot;pool1&quot;</span></div><div class="line">            { <span class="stringliteral">&quot;conv2_weights&quot;</span> },    <span class="comment">// Weights: input_layout &quot;conv2_weights&quot;</span></div><div class="line">            { <span class="stringliteral">&quot;conv2_bias&quot;</span> }        <span class="comment">// Bias: input_layout &quot;conv2_bias&quot;</span></div><div class="line">        ),</div><div class="line">        <span class="comment">// Second pooling id: &quot;pool2&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1pooling.html">pooling</a>(<span class="stringliteral">&quot;pool2&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;conv2&quot;</span>,                <span class="comment">// Input: &quot;conv2&quot;</span></div><div class="line">            <a class="code" href="group__cpp__primitives.html#gga44a38e1c6afb8bfb7f74d0c20cd0fba3a2ffe4e77325d9a7152f7086ea7aa5114">pooling_mode::max</a>,      <span class="comment">// Pooling mode: MAX</span></div><div class="line">            spatial(2, 2), <span class="comment">// stride: 2</span></div><div class="line">            spatial(2, 2)  <span class="comment">// kernel_size: 2</span></div><div class="line">        ),</div><div class="line">        <span class="comment">// Fully connected (inner product) primitive id &quot;fc1&quot;</span></div><div class="line">        <a class="code" href="structcldnn_1_1fully__connected.html">fully_connected</a>(<span class="stringliteral">&quot;fc1&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;pool2&quot;</span>,        <span class="comment">// Input: &quot;pool2&quot;</span></div><div class="line">            <span class="stringliteral">&quot;fc1_weights&quot;</span>,  <span class="comment">// &quot;fc1_weights&quot; will be added to the topology later</span></div><div class="line">            <span class="stringliteral">&quot;fc1_bias&quot;</span>,     <span class="comment">// will be defined later</span></div><div class="line">            <span class="keyword">true</span>            <span class="comment">// Use build-in Relu. Slope is set to 0 by default.</span></div><div class="line">        ),</div><div class="line">        <span class="comment">// Second FC/IP primitive id: &quot;fc2&quot;, input: &quot;fc1&quot;.</span></div><div class="line">        <span class="comment">// Weights (&quot;fc2_weights&quot;) and biases (&quot;fc2_bias&quot;) will be defined later.</span></div><div class="line">        <span class="comment">// Built-in Relu is disabled by default.</span></div><div class="line">        <a class="code" href="structcldnn_1_1fully__connected.html">fully_connected</a>(<span class="stringliteral">&quot;fc2&quot;</span>, <span class="stringliteral">&quot;fc1&quot;</span>, <span class="stringliteral">&quot;fc2_weights&quot;</span>, <span class="stringliteral">&quot;fc2_bias&quot;</span>),</div><div class="line">        <span class="comment">// The &quot;softmax&quot; primitive is not an input for any other,</span></div><div class="line">        <span class="comment">// so it will be automatically added to network outputs.</span></div><div class="line">        <a class="code" href="structcldnn_1_1softmax.html">softmax</a>(<span class="stringliteral">&quot;softmax&quot;</span>, <span class="stringliteral">&quot;fc2&quot;</span>)</div><div class="line">    );</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="structcldnn_1_1topology.html">topology</a>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Copy from a vector to cldnn::memory</span></div><div class="line"><span class="keywordtype">void</span> copy_to_memory(<a class="code" href="structcldnn_1_1memory.html">memory</a>&amp; mem, <span class="keyword">const</span> vector&lt;float&gt;&amp; src)</div><div class="line">{</div><div class="line">    <a class="code" href="structcldnn_1_1pointer.html">cldnn::pointer&lt;float&gt;</a> dst(mem);</div><div class="line">    std::copy(src.begin(), src.end(), dst.begin());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Execute network</span></div><div class="line"><span class="keywordtype">int</span> recognize_image(<a class="code" href="structcldnn_1_1network.html">network</a>&amp; <a class="code" href="structcldnn_1_1network.html">network</a>, <span class="keyword">const</span> <a class="code" href="structcldnn_1_1memory.html">memory</a>&amp; input_memory)</div><div class="line">{</div><div class="line">    <span class="comment">// Set/update network input</span></div><div class="line">    network.<a class="code" href="structcldnn_1_1network.html#a0fbfadf336a8c08bf4adc781afc6cf3c">set_input_data</a>(<span class="stringliteral">&quot;input&quot;</span>, input_memory);</div><div class="line"></div><div class="line">    <span class="comment">// Start network execution</span></div><div class="line">    <span class="keyword">auto</span> <a class="code" href="group__cpp__program.html#gga3848e071efdbd543eb28ff24d4cc53eba25bef4f25b60430e2ef377f1a2b97577">outputs</a> = network.<a class="code" href="structcldnn_1_1network.html#aa16123edb1ef1ce9849aa88818ea6746">execute</a>();</div><div class="line"></div><div class="line">    <span class="comment">// get_memory() blocks output generation completed</span></div><div class="line">    <span class="keyword">auto</span> output = <a class="code" href="group__cpp__program.html#gga3848e071efdbd543eb28ff24d4cc53eba25bef4f25b60430e2ef377f1a2b97577">outputs</a>.at(<span class="stringliteral">&quot;softmax&quot;</span>).get_memory();</div><div class="line"></div><div class="line">    <span class="comment">// Get direct access to output memory</span></div><div class="line">    <a class="code" href="structcldnn_1_1pointer.html">cldnn::pointer&lt;float&gt;</a> out_ptr(output);</div><div class="line"></div><div class="line">    <span class="comment">// Analyze result</span></div><div class="line">    <span class="keyword">auto</span> max_element_pos = max_element(out_ptr.begin(), out_ptr.end());</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(distance(out_ptr.begin(), max_element_pos));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// User-defined helpers which are out of this example scope</span></div><div class="line"><span class="comment">// //////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// Loads file to a vector of floats.</span></div><div class="line">vector&lt;float&gt; load_data(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; filename) { <span class="keywordflow">return</span>{ 0 }; }</div><div class="line"></div><div class="line"><span class="comment">// Allocates memory and load data from file.</span></div><div class="line"><span class="comment">// Memory layout is taken from file.</span></div><div class="line"><a class="code" href="structcldnn_1_1memory.html">memory</a> load_mem(<span class="keyword">const</span> <a class="code" href="structcldnn_1_1engine.html">engine</a>&amp; <a class="code" href="structcldnn_1_1engine.html">engine</a>, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; filename) { <span class="keywordflow">return</span>{ 0 }; }</div><div class="line"></div><div class="line"><span class="comment">// Load image, resize to [x,y] and store in a vector of floats</span></div><div class="line"><span class="comment">// in the order &quot;bfyx&quot;.</span></div><div class="line">vector&lt;float&gt; load_image_bfyx(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) { <span class="keywordflow">return</span>{ 0 }; }</div><div class="line"><span class="comment">// //////////////////////////////////////////////////////////////</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main_func()</div><div class="line">{</div><div class="line">    <span class="comment">// Use data type: float</span></div><div class="line">    <span class="keyword">auto</span> data_type = <a class="code" href="group__cpp__memory.html#structcldnn_1_1type__to__data__type">type_to_data_type&lt;float&gt;::value</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Network input layout</span></div><div class="line">    <a class="code" href="structcldnn_1_1layout.html">layout</a> in_layout(</div><div class="line">        data_type, <span class="comment">// stored data type</span></div><div class="line">        <a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6a6e811d769af6fd0cdd32bd8b1a695d4c">format::bfyx</a>, <span class="comment">// data stored in order batch-channel-Y-X, where X coordinate changes first.</span></div><div class="line">            {1, input_channels, input_size, input_size} <span class="comment">// batch: 1, channels: 1, Y: 28, X: 28</span></div><div class="line">        );</div><div class="line"></div><div class="line">    <span class="comment">// Create memory for conv1 weights</span></div><div class="line">    <a class="code" href="structcldnn_1_1layout.html">layout</a> conv1_weights_layout(data_type, <a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6a6e811d769af6fd0cdd32bd8b1a695d4c">format::bfyx</a>,{ conv1_out_channels, input_channels, conv_krnl_size, conv_krnl_size });</div><div class="line">    vector&lt;float&gt; my_own_buffer = load_data(<span class="stringliteral">&quot;conv1_weights.bin&quot;</span>);</div><div class="line">    <span class="comment">// The conv1_weights_mem is attached to my_own_buffer, so my_own_buffer should not be changed or descroyed until network execution completion.</span></div><div class="line">    <span class="keyword">auto</span> conv1_weights_mem = <a class="code" href="structcldnn_1_1memory.html#a3e9d17a57e6d4b6b584f66a8489e334d">memory::attach</a>(conv1_weights_layout, my_own_buffer.data(), my_own_buffer.size());</div><div class="line"></div><div class="line">    <span class="comment">// Create default engine</span></div><div class="line">    <a class="code" href="structcldnn_1_1engine.html">cldnn::engine</a> <a class="code" href="structcldnn_1_1engine.html">engine</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Create memory for conv1 bias</span></div><div class="line">    <a class="code" href="structcldnn_1_1layout.html">layout</a> conv1_bias_layout(data_type, <a class="code" href="structcldnn_1_1format.html#a018851934d0e0137b01f068dcbc5e3b6a6e811d769af6fd0cdd32bd8b1a695d4c">format::bfyx</a>, spatial(20));</div><div class="line">    <span class="comment">// Memory allocation requires engine</span></div><div class="line">    <span class="keyword">auto</span> conv1_bias_mem = <a class="code" href="structcldnn_1_1memory.html#aa737c150477dae753ed1b9ba73baf36e">memory::allocate</a>(engine, conv1_bias_layout);</div><div class="line">    <span class="comment">// The memory is allocated by library, so we do not need to care about buffer lifetime.</span></div><div class="line">    copy_to_memory(conv1_bias_mem, load_data(<span class="stringliteral">&quot;conv1_bias.bin&quot;</span>));</div><div class="line"></div><div class="line">    <span class="comment">// Get new topology</span></div><div class="line">    <a class="code" href="structcldnn_1_1topology.html">cldnn::topology</a> <a class="code" href="structcldnn_1_1topology.html">topology</a> = create_topology(in_layout, conv1_weights_mem, conv1_bias_mem);</div><div class="line"></div><div class="line">    <span class="comment">// Define network data not defined in create_topology()</span></div><div class="line">    topology.<a class="code" href="structcldnn_1_1topology.html#a2574507502bd3acbfe1769aee23d8039">add</a>(</div><div class="line">        <a class="code" href="structcldnn_1_1data.html">cldnn::data</a>(<span class="stringliteral">&quot;fc1_weights&quot;</span>, load_mem(engine, <span class="stringliteral">&quot;fc1_weights.data&quot;</span>)),</div><div class="line">        <a class="code" href="structcldnn_1_1data.html">cldnn::data</a>(<span class="stringliteral">&quot;fc1_bias&quot;</span>,    load_mem(engine, <span class="stringliteral">&quot;fc1_bias.data&quot;</span>)),</div><div class="line">        <a class="code" href="structcldnn_1_1data.html">cldnn::data</a>(<span class="stringliteral">&quot;fc2_weights&quot;</span>, load_mem(engine, <span class="stringliteral">&quot;fc2_weights.data&quot;</span>)),</div><div class="line">        <a class="code" href="structcldnn_1_1data.html">cldnn::data</a>(<span class="stringliteral">&quot;fc2_bias&quot;</span>,    load_mem(engine, <span class="stringliteral">&quot;fc2_bias.data&quot;</span>))</div><div class="line">        );</div><div class="line"></div><div class="line">    <span class="comment">// Build the network. Allow implicit data optimizations.</span></div><div class="line">    <span class="comment">// The &quot;softmax&quot; primitive is not used as an input for other primitives,</span></div><div class="line">    <span class="comment">// so we do not need to explicitly select it in build_options::outputs()</span></div><div class="line">    <a class="code" href="structcldnn_1_1network.html">cldnn::network</a> network(engine, topology, { <a class="code" href="structcldnn_1_1build__option.html#addad469cf8266da65513eaad772e67ef">build_option::optimize_data</a>(<span class="keyword">true</span>) });</div><div class="line"></div><div class="line">    <span class="comment">// Set network data which was not known at topology creation.</span></div><div class="line">    network.<a class="code" href="structcldnn_1_1network.html#a0fbfadf336a8c08bf4adc781afc6cf3c">set_input_data</a>(<span class="stringliteral">&quot;conv2_weights&quot;</span>, load_mem(engine, <span class="stringliteral">&quot;conv2_weights.data&quot;</span>));</div><div class="line">    network.<a class="code" href="structcldnn_1_1network.html#a0fbfadf336a8c08bf4adc781afc6cf3c">set_input_data</a>(<span class="stringliteral">&quot;conv2_bias&quot;</span>, load_mem(engine, <span class="stringliteral">&quot;conv2_bias.data&quot;</span>));</div><div class="line"></div><div class="line">    <span class="comment">// Allocate memory for input image.</span></div><div class="line">    <span class="keyword">auto</span> input_memory = <a class="code" href="structcldnn_1_1memory.html#aa737c150477dae753ed1b9ba73baf36e">memory::allocate</a>(engine, in_layout);</div><div class="line"></div><div class="line">    <span class="comment">// Run network 2 times with different images.</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> img_name : { <span class="stringliteral">&quot;one.jpg&quot;</span>, <span class="stringliteral">&quot;two.jpg&quot;</span> })</div><div class="line">    {</div><div class="line">        <span class="comment">// Reuse image memory.</span></div><div class="line">        copy_to_memory(input_memory, load_image_bfyx(<span class="stringliteral">&quot;one.jpg&quot;</span>, in_layout.<a class="code" href="structcldnn_1_1layout.html#ae84c460aee3a37c7e0f8c83d83e8cb1f">size</a>.<a class="code" href="structcldnn_1_1tensor.html#a2910e446899768593464fbdcc3ead97f">spatial</a>[0], in_layout.<a class="code" href="structcldnn_1_1layout.html#ae84c460aee3a37c7e0f8c83d83e8cb1f">size</a>.<a class="code" href="structcldnn_1_1tensor.html#a2910e446899768593464fbdcc3ead97f">spatial</a>[1]));</div><div class="line">        <span class="keyword">auto</span> result = recognize_image(network, input_memory);</div><div class="line">        cout &lt;&lt; img_name &lt;&lt; <span class="stringliteral">&quot; recognized as&quot;</span> &lt;&lt; result &lt;&lt; endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
